{"status":{},"contains_secrets":false,"product_version":"3.3.0","spec":{"description":"","resources":{"client_attrs":{"fc73d065_deployment":{"y":-418.5856090338,"x":530.8146253912},"None":{"y":-144.0220947266,"x":165.048828125},"007e9ee0_deployment":{"y":-285.4024660422,"x":272.0733285179}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e0f7e251_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"5061d873_runbook","main_task_local_reference":{"kind":"app_task","name":"e0f7e251_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"94d8f7c0_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9aa2d474_runbook","main_task_local_reference":{"kind":"app_task","name":"94d8f7c0_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"d7d233e7_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"a7b2b618_runbook","main_task_local_reference":{"kind":"app_task","name":"d7d233e7_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"d7a2470a_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"4426315f_runbook","main_task_local_reference":{"kind":"app_task","name":"d7a2470a_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"f5149bf3_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"bd3889ce_runbook","main_task_local_reference":{"kind":"app_task","name":"f5149bf3_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"master","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"_JOIN_COMMAND","value":"","label":"","attrs":{"type":""},"editables":{"value":false},"is_hidden":true,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"K8S_VERSION","value":"1.21.5","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"DOCKER_VERSION","value":"","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"worker"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a43f69ab_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"a5832d96_runbook","main_task_local_reference":{"kind":"app_task","name":"a43f69ab_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"worker"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"5bc517e2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"e34ef29e_runbook","main_task_local_reference":{"kind":"app_task","name":"5bc517e2_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"worker"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"baddd0e8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"75f6fc0f_runbook","main_task_local_reference":{"kind":"app_task","name":"baddd0e8_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"worker"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a3935767_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"0ed6f0be_runbook","main_task_local_reference":{"kind":"app_task","name":"a3935767_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"worker"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a49d1341_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"876ab1a8_runbook","main_task_local_reference":{"kind":"app_task","name":"a49d1341_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"master"}],"name":"worker","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"k1m","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":true,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"editables":{"create_spec":{"resources":{"nic_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"serial_port_list":{}}}},"os_type":"Linux","create_spec":{"name":"k8sm","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"5e243471-3788-4a49-9e63-c4cb4de57401"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"gpu_list":[],"memory_size_mib":8192,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nrepo_update: true\nrepo_upgrade: all\npackage_upgrade: true\ndisable_root: False\nssh_enabled: True\nchpasswd: { expire: False }\nusers:\n- name: centos\n  sudo: ALL=(ALL) NOPASSWD:ALL\n  groups: wheel, users\n  ssh_authorized_keys:\n    - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCvusjsw3uq3kow59nUrW7IDni9vvI+pW9fyLoWEcoir4pzdMrL3aqIcsw6Wd3twX04NrWdxBw20vndYk+JDrN4hMD7LoBQdoV7+qV5rCMMuZrm96r15K\/CwMyL6TA6WDJ9GJJx6iLp5CBB5ZjF6+02uc6DApBymiExFWYL++mv2THPWdBlxghmwlF8eOE+GfLtsTE\/y5cyAHWmf6sxCzGCIMlHkXIm2Yl+Q4OUNuPy0qUFT+I8+kX8ccYWbA\/tTqdcS6H2oYY8QcGoGa2HyC1IVuuY0adlbFrNRRiu\/A0uCmQyZwBFy+U0GHppq+\/3VwFxj50fOuAq4n1dw\/ER\/NlH centos\npackages:\n - git\n - curl\n - htop\n - wget\n"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"70067642-bea5-4979-ad95-4eee476c9a80","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"CentOS7","uuid":"f1766a52-b602-44ae-a2c2-6e384afb8ae6"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"k1w","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":true,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"editables":{"create_spec":{"resources":{"nic_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"serial_port_list":{}}}},"os_type":"Linux","create_spec":{"name":"k8sw@@{calm_array_index}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"5e243471-3788-4a49-9e63-c4cb4de57401"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"gpu_list":[],"memory_size_mib":8192,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nrepo_update: true\nrepo_upgrade: all\npackage_upgrade: true\ndisable_root: False\nssh_enabled: True\nchpasswd: { expire: False }\nusers:\n- name: centos\n  sudo: ALL=(ALL) NOPASSWD:ALL\n  groups: wheel, users\n  ssh_authorized_keys:\n    - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCvusjsw3uq3kow59nUrW7IDni9vvI+pW9fyLoWEcoir4pzdMrL3aqIcsw6Wd3twX04NrWdxBw20vndYk+JDrN4hMD7LoBQdoV7+qV5rCMMuZrm96r15K\/CwMyL6TA6WDJ9GJJx6iLp5CBB5ZjF6+02uc6DApBymiExFWYL++mv2THPWdBlxghmwlF8eOE+GfLtsTE\/y5cyAHWmf6sxCzGCIMlHkXIm2Yl+Q4OUNuPy0qUFT+I8+kX8ccYWbA\/tTqdcS6H2oYY8QcGoGa2HyC1IVuuY0adlbFrNRRiu\/A0uCmQyZwBFy+U0GHppq+\/3VwFxj50fOuAq4n1dw\/ER\/NlH centos\npackages:\n - git\n - curl\n - htop\n - wget\n"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"70067642-bea5-4979-ad95-4eee476c9a80","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"CentOS7","uuid":"f1766a52-b602-44ae-a2c2-6e384afb8ae6"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"centos","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"CENTOS","cred_class":"static"}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"master"}],"name":"Package1","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Initial"},{"kind":"app_task","name":"InsertPrivateKey"},{"kind":"app_task","name":"UpdateHostFile"},{"kind":"app_task","name":"SetMasterHostName"},{"kind":"app_task","name":"InstallDockerAndK8S"},{"kind":"app_task","name":"InitializeK8SMaster"}],"name":"2e4c2002_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"InsertPrivateKey"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"UpdateHostFile"}},{"from_task_reference":{"kind":"app_task","name":"UpdateHostFile"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"SetMasterHostName"}},{"from_task_reference":{"kind":"app_task","name":"SetMasterHostName"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"InstallDockerAndK8S"}},{"from_task_reference":{"kind":"app_task","name":"InstallDockerAndK8S"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"InitializeK8SMaster"}},{"from_task_reference":{"kind":"app_task","name":"Initial"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"InsertPrivateKey"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Initial","attrs":{"exit_status":[],"script":"#script\nprint \"K8S_VERSION=@@{K8S_VERSION}@@\"\nprint \"DOCKER_VERSION=@@{DOCKER_VERSION}@@\"","eval_variables":["K8S_VERSION","DOCKER_VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"InsertPrivateKey","attrs":{"script":"#!\/bin\/bash -ex\n\ncat <<EOF | tee \/home\/centos\/centos.priv\n-----BEGIN RSA PRIVATE KEY-----\nMIIEowIBAAKCAQEAr7rI7MN7qt5KMOfZ1K1uyA54vb7yPqVvX8i6FhHKIq+Kc3TK\ny92qiHLMOlnd7cF9ODa1ncQcNtL53WJPiQ6zeITA+y6AUHaFe\/qleawjDLma5veq\n9eSvwsDMi+kwOlgyfRiSceoi6eQgQeWYxevtNrnOgwKQcpohMRVmC\/vpr9kxz1nQ\nZcYIZsJRfHjhPhny7bExP8uXMgB1pn+rMQsxgiDJR5FyJtmJfkODlDbj8tKlBU\/i\nPPpF\/HHGFmwP7U6nXEuh9qGGPEHBqBmth8gtSFbrmNGnZWxazUUYrvwNLgpkMmcA\nRcvlNBh6aavv91cBcY+dHzrgKuJ9XcPxEfzZRwIDAQABAoIBABof66T\/PtBdMaxp\nm4G5suF8\/UhALeVQVOlpfviu9l0Huc6GS2vZbXPRlTkLiSnCfSoxP\/jPYd5oqQrX\nhbl7fQTqv4HYHO1ZYWjYD2eyRpeqtDOoGDtsHxEV9pLKPQg\/emoMkCDtTPl2l7EU\nQA0UkPR01RW2+OCAt3SDmOMpNUmWAkKCDgIAJwXKTn7yi127B6vCImpMlDli4zNg\nxY58gW8QRNpw2\/e6EjXW8lnhIYHrnzN2dYuZOtCh\/6dhkTBxpczYVH1ax7ZOoKaA\n1hT9SDXJ6BnjprtRxCcwr4zAV+qgfW7eYvb1uel76ELsz+Jy4SyH\/jS0X6WNkd3z\nIhyZDTECgYEA5hzfvWbkfjsu7NpZeqYc+ABEcRfBXknF3JxnLwG+Kq63yOAEtR0c\nfDTEP\/iLw0NCWhw49tm1n28h6OM3bKH\/VPBRXM93yR5VWq2U7qQ1HSRwvcl7r+KL\nMbSbQ4iDm4s5aK8y4t1d0GLd15jdjajK0hivVN61HuWQC6yU6i82Bt8CgYEAw3+0\nawQvNXXSLvj2HTMbZXqvkGcghCkSxn0abmIrDglccbYKo4ket\/\/5i1FgJ3al40CY\nWe0j9AqY7ZX39AmtskLTveVqS5r8HbGDVnMHJFgUKd+88xkHlr6EZa3X79z6p0p0\nJu\/O73LGMM\/HjrSHM9sQ0c+g8M4AFhvwrI77ApkCgYAS5pY+EWB9OdE95SVqXJCO\nkj8M5v2cCAU3fKVBCCydhuJTnorkcXKwhQkFlB2uuSyPCDhpljJD2TX40gjwZFH7\noQ2dyPC21UX\/f7h27YfrT93uyMjfBoWWXJZQMrtUoFfj0FgmqDYXcrd0CPtRsmaO\nYTatiulnk0WEn\/VPUvdmEwKBgALdHAd1SDvAPhPyEajb1srlwSycVh2ZfGzr6Dc1\nuOu7t17zC7TZjVmkpkMkLgRl+Igbqh+nGZ+5iAPy7m7ktWanE\/L0KVpyKr9Emmfp\nx3EA2UrDvEDTXQkYQVg7863Pztwkew8W9DENvVl5sbKlclWQH+7y26irW9T3E89z\nSLoBAoGBALfSQnn+Ieg626763ziFSo85OXXTBEfKcReEqc7bMmv\/GYjpz2dpngut\nV67OAPGnlburEqlmCcvr9lOB7UzYH5t3PcdlrYbWZ07HC8G9RdpVPcR42CgcT1Fy\nfKnWCu7q3uafdOyNnLxlelR7UGr7DYx7XgHIVQ2F1wNwggYrE8d2\n-----END RSA PRIVATE KEY-----\nEOF\n\nchmod 600 \/home\/centos\/centos.priv\n\nK8S_VERSION=\"@@{calm_array_K8S_VERSION}@@\"\nDOCKER_VERSION=\"@@{calm_array_DOCKER_VERSION}@@\"\n\n## K8S_VERSION=@@{K8S_VERSION}@@\n\necho $K8S_VERSION\necho $DOCKER_VERSION","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"UpdateHostFile","attrs":{"script":"#!\/bin\/bash -ex\n\ncat <<EOF | sudo tee -a \/etc\/hosts\n\n@@{k1m.address}@@      k8sm\n@@{k1w.address[0]}@@      k8sw0\n@@{k1w.address[1]}@@      k8sw1\n@@{k1w.address[2]}@@      k8sw2\n\nEOF\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"SetMasterHostName","attrs":{"exit_status":[],"script":"#!\/bin\/bash -ex\n\nsudo hostnamectl set-hostname k8sm\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"InstallDockerAndK8S","attrs":{"exit_status":[],"script":"#!\/bin\/bash -ex\n\nsudo modprobe br_netfilter\n\ncat <<EOF | sudo tee \/etc\/sysctl.d\/k8s.conf\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\nsudo sysctl --system\n\nDOCKER_VERSION=\"@@{calm_array_DOCKER_VERSION}@@\"\n\nsudo yum install -y yum-utils\nsudo yum-config-manager  \\\n    --add-repo \\\n    https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y docker-ce-${DOCKER_VERSION} docker-ce-cli-${DOCKER_VERSION} containerd.io\nsudo systemctl enable --now docker\nsudo systemctl status docker\n\n\ncat <<EOF | sudo tee \/etc\/yum.repos.d\/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https:\/\/packages.cloud.google.com\/yum\/repos\/kubernetes-el7-\\$basearch\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https:\/\/packages.cloud.google.com\/yum\/doc\/yum-key.gpg https:\/\/packages.cloud.google.com\/yum\/doc\/rpm-package-key.gpg\nexclude=kubelet kubeadm kubectl\nEOF\n\n# Set SELinux in permissive mode (effectively disabling it)\nsudo setenforce 0\nsudo sed -i 's\/^SELINUX=enforcing$\/SELINUX=permissive\/' \/etc\/selinux\/config\n\nsudo swapoff -a\n\nK8S_VERSION=\"@@{calm_array_K8S_VERSION}@@\"\n#K8S_VERSION=1.20.2\necho $K8S_VERSION\n#K8S_VERSION=1.21.3\n\nsudo yum install -y kubelet-${K8S_VERSION} kubeadm-${K8S_VERSION} kubectl-${K8S_VERSION} --disableexcludes=kubernetes\n\n\nsudo systemctl enable --now kubelet\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"InitializeK8SMaster","attrs":{"exit_status":[],"script":"#!\/bin\/bash -ex\n\n_k8s_token=`kubeadm token generate`\n\nsudo kubeadm init --token ${_k8s_token}| tee \/home\/centos\/kubadm.log | tail -n 2 | tee  \/home\/centos\/join-cmd.sh\n\nmkdir -p \/home\/centos\/.kube\nsudo cp -i \/etc\/kubernetes\/admin.conf \/home\/centos\/.kube\/config\nsudo chown $(id -u):$(id -g) \/home\/centos\/.kube\/config\n\ncurl https:\/\/docs.projectcalico.org\/manifests\/calico.yaml -O\nkubectl apply -f calico.yaml\n\ncat \/home\/centos\/join-cmd.sh\n\nscp -o StrictHostKeyChecking=no -i \/home\/centos\/centos.priv \/home\/centos\/join-cmd.sh centos@k8sw0:\nscp -o StrictHostKeyChecking=no -i \/home\/centos\/centos.priv \/home\/centos\/join-cmd.sh centos@k8sw1:\nscp -o StrictHostKeyChecking=no -i \/home\/centos\/centos.priv \/home\/centos\/join-cmd.sh centos@k8sw2:\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"3b1d606b_runbook","main_task_local_reference":{"kind":"app_task","name":"2e4c2002_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"6e477f25_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"6cd3da2f_runbook","main_task_local_reference":{"kind":"app_task","name":"6e477f25_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"worker"}],"name":"Package2","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package2"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Initialize"},{"kind":"app_task","name":"InsertPrivateKey"},{"kind":"app_task","name":"UpdateHostFile"},{"kind":"app_task","name":"InstallDockerAndK8S"},{"kind":"app_task","name":"JoinK8SCluster"}],"name":"6c3acea0_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"InsertPrivateKey"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"UpdateHostFile"}},{"from_task_reference":{"kind":"app_task","name":"UpdateHostFile"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"InstallDockerAndK8S"}},{"from_task_reference":{"kind":"app_task","name":"InstallDockerAndK8S"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"JoinK8SCluster"}},{"from_task_reference":{"kind":"app_task","name":"Initialize"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"InsertPrivateKey"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"worker"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Initialize","attrs":{"exit_status":[],"script":"print \"K8S_VERSION=@@{master.K8S_VERSION}@@\"","eval_variables":["K8S_VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"worker"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"InsertPrivateKey","attrs":{"exit_status":[],"script":"#!\/bin\/bash -ex\n\ncat <<EOF | tee \/home\/centos\/centos.priv\n-----BEGIN RSA PRIVATE KEY-----\nMIIEowIBAAKCAQEAr7rI7MN7qt5KMOfZ1K1uyA54vb7yPqVvX8i6FhHKIq+Kc3TK\ny92qiHLMOlnd7cF9ODa1ncQcNtL53WJPiQ6zeITA+y6AUHaFe\/qleawjDLma5veq\n9eSvwsDMi+kwOlgyfRiSceoi6eQgQeWYxevtNrnOgwKQcpohMRVmC\/vpr9kxz1nQ\nZcYIZsJRfHjhPhny7bExP8uXMgB1pn+rMQsxgiDJR5FyJtmJfkODlDbj8tKlBU\/i\nPPpF\/HHGFmwP7U6nXEuh9qGGPEHBqBmth8gtSFbrmNGnZWxazUUYrvwNLgpkMmcA\nRcvlNBh6aavv91cBcY+dHzrgKuJ9XcPxEfzZRwIDAQABAoIBABof66T\/PtBdMaxp\nm4G5suF8\/UhALeVQVOlpfviu9l0Huc6GS2vZbXPRlTkLiSnCfSoxP\/jPYd5oqQrX\nhbl7fQTqv4HYHO1ZYWjYD2eyRpeqtDOoGDtsHxEV9pLKPQg\/emoMkCDtTPl2l7EU\nQA0UkPR01RW2+OCAt3SDmOMpNUmWAkKCDgIAJwXKTn7yi127B6vCImpMlDli4zNg\nxY58gW8QRNpw2\/e6EjXW8lnhIYHrnzN2dYuZOtCh\/6dhkTBxpczYVH1ax7ZOoKaA\n1hT9SDXJ6BnjprtRxCcwr4zAV+qgfW7eYvb1uel76ELsz+Jy4SyH\/jS0X6WNkd3z\nIhyZDTECgYEA5hzfvWbkfjsu7NpZeqYc+ABEcRfBXknF3JxnLwG+Kq63yOAEtR0c\nfDTEP\/iLw0NCWhw49tm1n28h6OM3bKH\/VPBRXM93yR5VWq2U7qQ1HSRwvcl7r+KL\nMbSbQ4iDm4s5aK8y4t1d0GLd15jdjajK0hivVN61HuWQC6yU6i82Bt8CgYEAw3+0\nawQvNXXSLvj2HTMbZXqvkGcghCkSxn0abmIrDglccbYKo4ket\/\/5i1FgJ3al40CY\nWe0j9AqY7ZX39AmtskLTveVqS5r8HbGDVnMHJFgUKd+88xkHlr6EZa3X79z6p0p0\nJu\/O73LGMM\/HjrSHM9sQ0c+g8M4AFhvwrI77ApkCgYAS5pY+EWB9OdE95SVqXJCO\nkj8M5v2cCAU3fKVBCCydhuJTnorkcXKwhQkFlB2uuSyPCDhpljJD2TX40gjwZFH7\noQ2dyPC21UX\/f7h27YfrT93uyMjfBoWWXJZQMrtUoFfj0FgmqDYXcrd0CPtRsmaO\nYTatiulnk0WEn\/VPUvdmEwKBgALdHAd1SDvAPhPyEajb1srlwSycVh2ZfGzr6Dc1\nuOu7t17zC7TZjVmkpkMkLgRl+Igbqh+nGZ+5iAPy7m7ktWanE\/L0KVpyKr9Emmfp\nx3EA2UrDvEDTXQkYQVg7863Pztwkew8W9DENvVl5sbKlclWQH+7y26irW9T3E89z\nSLoBAoGBALfSQnn+Ieg626763ziFSo85OXXTBEfKcReEqc7bMmv\/GYjpz2dpngut\nV67OAPGnlburEqlmCcvr9lOB7UzYH5t3PcdlrYbWZ07HC8G9RdpVPcR42CgcT1Fy\nfKnWCu7q3uafdOyNnLxlelR7UGr7DYx7XgHIVQ2F1wNwggYrE8d2\n-----END RSA PRIVATE KEY-----\nEOF\n\nchmod 600 \/home\/centos\/centos.priv\n\nK8S_VERSION=\"@@{calm_array_K8S_VERSION}@@\"\necho $K8S_VERSION","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"worker"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"UpdateHostFile","attrs":{"script":"#!\/bin\/bash -ex\n\ncat <<EOF | sudo tee -a \/etc\/hosts\n\n@@{k1m.address}@@      k8sm\n@@{k1w.address[0]}@@      k8sw0\n@@{k1w.address[1]}@@      k8sw1\n@@{k1w.address[2]}@@      k8sw2\n\nEOF\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"worker"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"InstallDockerAndK8S","attrs":{"script":"#!\/bin\/bash -ex\n\nsudo modprobe br_netfilter\n\ncat <<EOF | sudo tee \/etc\/sysctl.d\/k8s.conf\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\nsudo sysctl --system\n\nDOCKER_VERSION=19.03.9\n\nsudo yum install -y yum-utils\nsudo yum-config-manager  \\\n    --add-repo \\\n    https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y docker-ce-${DOCKER_VERSION} docker-ce-cli-${DOCKER_VERSION} containerd.io\nsudo systemctl enable --now docker\nsudo systemctl status docker\n\n\ncat <<EOF | sudo tee \/etc\/yum.repos.d\/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https:\/\/packages.cloud.google.com\/yum\/repos\/kubernetes-el7-\\$basearch\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https:\/\/packages.cloud.google.com\/yum\/doc\/yum-key.gpg https:\/\/packages.cloud.google.com\/yum\/doc\/rpm-package-key.gpg\nexclude=kubelet kubeadm kubectl\nEOF\n\n# Set SELinux in permissive mode (effectively disabling it)\nsudo setenforce 0\nsudo sed -i 's\/^SELINUX=enforcing$\/SELINUX=permissive\/' \/etc\/selinux\/config\n\nsudo swapoff -a\n\nK8S_VERSION=\"@@{master.K8S_VERSION}@@\"\n#K8S_VERSION=1.20.2\n\nsudo yum install -y kubelet-${K8S_VERSION} kubeadm-${K8S_VERSION} kubectl-${K8S_VERSION} --disableexcludes=kubernetes\n\n# sudo yum install -y kubelet-${K8S_VERSION} kubeadm-${K8S_VERSION} kubectl-${K8S_VERSION} --disableexcludes=kubernetes\n\n\nsudo systemctl enable --now kubelet\n\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"worker"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"JoinK8SCluster","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\nwhile [ ! -f \/home\/centos\/join-cmd.sh ]; do sleep 1; done\n\nchmod +x \/home\/centos\/join-cmd.sh\n\nsudo \/home\/centos\/join-cmd.sh","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"22c3f9df_runbook","main_task_local_reference":{"kind":"app_task","name":"6c3acea0_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package2"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"12457205_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"66d6dd37_runbook","main_task_local_reference":{"kind":"app_task","name":"12457205_dag"},"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"fc73d065_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package1"}],"substrate_local_reference":{"kind":"app_substrate","name":"k1m"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"007e9ee0_deployment","min_replicas":"2","default_replicas":"3","depends_on_list":[],"editables":{"min_replicas":true,"default_replicas":true,"max_replicas":true},"published_service_local_reference_list":[],"max_replicas":"10","package_local_reference_list":[{"kind":"app_package","name":"Package2"}],"substrate_local_reference":{"kind":"app_substrate","name":"k1w"},"variable_list":[],"description":""}],"environment_reference_list":[],"patch_list":[],"description":"","action_list":[],"name":"Default","restore_config_list":[],"snapshot_config_list":[],"variable_list":[]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"CENTOS"},"type":"USER"},"name":"kubeadmx"},"api_version":"3.0","metadata":{"last_update_time":"1633587126762529","kind":"blueprint","spec_version":45,"creation_time":"1633507314964362","name":"kubeadmx"}}